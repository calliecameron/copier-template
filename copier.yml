_min_copier_version: "9.10.2"
_envops:
  keep_trailing_newline: true
  trim_blocks: true
  lstrip_blocks: true
_jinja_extensions:
  - copier_template_extensions.TemplateExtensionLoader
  - cookiecutter.extensions.SlugifyExtension
  - extensions/extensions.py:StrictUndefinedExtension
  - extensions/extensions.py:GitExtension
  - extensions/extensions.py:UvExtension
  - extensions/extensions.py:NvmExtension
  - extensions/extensions.py:ConfigExtension
_subdirectory: template
_message_after_copy: |

  ------
  Template applied successfully. Run 'make' to verify.

  You may also want to run 'make update_deps' in case the versions installed by
  the template are outdated.
_message_after_update: |

  ------
  Template applied successfully. Run 'make' to verify.

  You may also want to run 'make update_deps' in case the versions installed by
  the template are outdated.
_tasks:
  - command: uv lock
    when: "{{ uses_uv }}"
  - command: bash -c 'source "${NVM_DIR}/nvm.sh" && nvm exec --silent npm install'
    when: "{{ uses_npm }}"

file_type_tags:
  type: yaml
  default: "{{ '' | file_type_tags }}"
  when: false

base_config:
  type: yaml
  default:
    file_types:
      - markdown # README.md
      - json # .vscode/settings.json
    tools:
      - uv
      - copier
      - pre-commit
      - typos
      - gitleaks
      - gitlint
  when: false

config_stage1:
  type: yaml
  default: "{{ base_config | expand_config({}) }}"
  when: false

python_version:
  type: str
  default: "{{ '' | get_python_version }}"
  when: false

node_version:
  type: str
  default: "{{ '' | get_node_version }}"
  when: false

project_name:
  type: str
  help: Project name
  validator: "{% if not project_name %}Project name must not be empty{% endif %}"

project_version:
  type: str
  help: Project version
  default: "0.0.0"
  validator: "{% if not project_version %}Project version must not be empty{% endif %}"

author_name:
  type: str
  help: Author name
  default: "{{ '' | get_git_user_name }}"
  validator: "{% if not author_name %}Author name must not be empty{% endif %}"

copyright_start_year:
  type: str
  default: "{{ copyright_start_year | default('%Y' | strftime) }}"
  when: false

copyright_end_year:
  type: str
  default: "{{ '%Y' | strftime }}"
  when: false

detected_config:
  type: yaml
  default: "{{ '' | detect_config }}"
  when: false

config_stage2:
  type: yaml
  default: "{{ detected_config | expand_config(config_stage1) }}"
  when: false

user_has_shell:
  type: bool
  help: Has shell scripts?
  default: "{{ 'shell' in config_stage2['file_types'] }}"
  when: "{{ 'shell' not in config_stage2['file_types'] }}"

user_has_python:
  type: bool
  help: Has python?
  default: "{{ 'python' in config_stage2['file_types'] }}"
  when: "{{ 'python' not in config_stage2['file_types'] }}"

user_has_javascript:
  type: bool
  help: Has javascript?
  default: "{{ 'javascript' in config_stage2['file_types'] }}"
  when: "{{ 'javascript' not in config_stage2['file_types'] }}"

user_has_html:
  type: bool
  help: Has HTML?
  default: "{{ 'html' in config_stage2['file_types'] }}"
  when: "{{ 'html' not in config_stage2['file_types'] }}"

user_has_css:
  type: bool
  help: Has CSS?
  default: "{{ 'css' in config_stage2['file_types'] }}"
  when: "{{ 'css' not in config_stage2['file_types'] }}"

user_has_markdown:
  type: bool
  help: Has markdown?
  default: "{{ 'markdown' in config_stage2['file_types'] }}"
  when: "{{ 'markdown' not in config_stage2['file_types'] }}"

user_has_json:
  type: bool
  help: Has json?
  default: "{{ 'json' in config_stage2['file_types'] }}"
  when: "{{ 'json' not in config_stage2['file_types'] }}"

user_has_yaml:
  type: bool
  help: Has yaml?
  default: "{{ 'yaml' in config_stage2['file_types'] }}"
  when: "{{ 'yaml' not in config_stage2['file_types'] }}"

user_has_toml:
  type: bool
  help: Has toml?
  default: "{{ 'toml' in config_stage2['file_types'] }}"
  when: "{{ 'toml' not in config_stage2['file_types'] }}"

user_config:
  type: yaml
  default: |
    file_types:
      {% if user_has_shell %}
      - shell
      {% endif %}
      {% if user_has_python %}
      - python
      {% endif %}
      {% if user_has_javascript %}
      - javascript
      {% endif %}
      {% if user_has_html %}
      - html
      {% endif %}
      {% if user_has_css %}
      - css
      {% endif %}
      {% if user_has_markdown %}
      - markdown
      {% endif %}
      {% if user_has_json %}
      - json
      {% endif %}
      {% if user_has_yaml %}
      - yaml
      {% endif %}
      {% if user_has_toml %}
      - toml
      {% endif %}
  when: false

config:
  type: yaml
  default: "{{ user_config | expand_config(config_stage2) }}"
  when: false

has_shell:
  type: bool
  default: "{{ 'shell' in config['file_types'] }}"
  when: false

has_python:
  type: bool
  default: "{{ 'python' in config['file_types'] }}"
  when: false

has_javascript:
  type: bool
  default: "{{ 'javascript' in config['file_types'] }}"
  when: false

has_html:
  type: bool
  default: "{{ 'html' in config['file_types'] }}"
  when: false

has_css:
  type: bool
  default: "{{ 'css' in config['file_types'] }}"
  when: false

has_markdown:
  type: bool
  default: "{{ 'markdown' in config['file_types'] }}"
  when: false

has_json:
  type: bool
  default: "{{ 'json' in config['file_types'] }}"
  when: false

has_yaml:
  type: bool
  default: "{{ 'yaml' in config['file_types'] }}"
  when: false

has_toml:
  type: bool
  default: "{{ 'toml' in config['file_types'] }}"
  when: false

uses_uv:
  type: bool
  default: "{{ 'uv' in config['tools'] }}"
  when: false

uses_copier:
  type: bool
  default: "{{ 'copier' in config['tools'] }}"
  when: false

uses_pre_commit:
  type: bool
  default: "{{ 'pre-commit' in config['tools'] }}"
  when: false

uses_npm:
  type: bool
  default: "{{ 'npm' in config['tools'] }}"
  when: false

uses_prettier:
  type: bool
  default: "{{ 'prettier' in config['tools'] }}"
  when: false

uses_shellcheck:
  type: bool
  default: "{{ 'shellcheck' in config['tools'] }}"
  when: false

uses_shfmt:
  type: bool
  default: "{{ 'shfmt' in config['tools'] }}"
  when: false

uses_ruff:
  type: bool
  default: "{{ 'ruff' in config['tools'] }}"
  when: false

uses_mypy:
  type: bool
  default: "{{ 'mypy' in config['tools'] }}"
  when: false

uses_eslint:
  type: bool
  default: "{{ 'eslint' in config['tools'] }}"
  when: false

uses_htmlvalidate:
  type: bool
  default: "{{ 'htmlvalidate' in config['tools'] }}"
  when: false

uses_stylelint:
  type: bool
  default: "{{ 'stylelint' in config['tools'] }}"
  when: false

uses_markdownlint:
  type: bool
  default: "{{ 'markdownlint' in config['tools'] }}"
  when: false

uses_yamllint:
  type: bool
  default: "{{ 'yamllint' in config['tools'] }}"
  when: false

uses_tombi:
  type: bool
  default: "{{ 'tombi' in config['tools'] }}"
  when: false

uses_typos:
  type: bool
  default: "{{ 'typos' in config['tools'] }}"
  when: false

uses_gitleaks:
  type: bool
  default: "{{ 'gitleaks' in config['tools'] }}"
  when: false

uses_gitlint:
  type: bool
  default: "{{ 'gitlint' in config['tools'] }}"
  when: false

python_line_length:
  type: int
  help: Python line length
  default: 88 # ruff's default
  validator: "{% if python_line_length < 80 %}Python line length must be at least 80{% endif %}"
  when: "{{ has_python }}"
